<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; font-src https://fonts.gstatic.com; img-src 'self' https: data:; connect-src 'self';">
  <title>Blog Post - sushi.lab</title>
  <meta name="description" content="Blog post on sushi.lab â€” AI research, technical deep dives, and insights.">
  <meta name="author" content="Shushank Singh">
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="sushi.lab">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@thisisshushank">
  <meta name="theme-color" content="#0A0A0A">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/src/css/variables.css">
  <link rel="stylesheet" href="/src/css/reset.css">
  <link rel="stylesheet" href="/src/css/base.css">
  <link rel="stylesheet" href="/src/css/components.css">
  <link rel="stylesheet" href="/src/css/animations.css">
  <link rel="stylesheet" href="/src/css/blog.css">
</head>
<body>
  <!-- Reading Progress Bar -->
  <div class="reading-progress"></div>

  <!-- Header -->
  <header class="header">
    <div class="container">
      <a href="/" class="header-logo"><img src="/logo.svg" alt="" class="header-logo-icon" width="24" height="24">sushi<span class="logo-dot">.</span>lab</a>
      <nav class="header-nav">
        <a href="/">Home</a>
        <a href="/blog/" class="active">Blog</a>
        <a href="/tutorials/">Tutorials</a>
        <a href="/projects/">Projects</a>
        <a href="/about/">About</a>
      </nav>
      <div class="header-actions">
        <a href="https://github.com/shushankai" target="_blank" rel="noopener" class="header-link">
          <i data-lucide="github"></i> GitHub
        </a>
      </div>
    </div>
  </header>

  <!-- Post Hero -->
  <section class="post-hero blob-container" style="position: relative;">
    <div class="three-canvas-container" data-particles="40"></div>
    <div class="blob blob-pink" data-parallax="-0.04" aria-hidden="true"></div>
    <div class="blob blob-yellow" data-parallax="0.06" aria-hidden="true"></div>
    <div class="blob blob-green" data-parallax="-0.03" aria-hidden="true"></div>
    <div class="container post-hero-content">
      <a href="/blog/" class="post-back-link" data-animate="fade-up">
        <i data-lucide="arrow-left"></i> Back to Blog
      </a>
      <div class="post-tags" id="post-tags" data-animate="fade-up" data-delay="100">
        <!-- Populated by JS -->
      </div>
      <h1 class="post-title" id="post-title" data-animate="fade-up" data-delay="200">Loading...</h1>
      <p class="post-subtitle" id="post-subtitle" data-animate="fade-up" data-delay="300"></p>
      <div class="post-author-row" data-animate="fade-up" data-delay="400">
        <div class="post-avatar">
          <div style="width:100%;height:100%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;color:white;font-size:1.2rem;">SS</div>
        </div>
        <div class="post-author-info">
          <span class="post-author-name" id="post-author">Shushank Singh</span>
          <div class="post-author-meta" id="post-meta">
            <!-- Populated by JS -->
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Post Content Layout -->
  <div class="post-layout container">
    <!-- Main Article -->
    <article class="article-body" id="post-body">
      <!-- Populated by JS -->
    </article>

    <!-- Sidebar -->
    <aside class="post-sidebar" data-animate="slide-left" data-delay="200">
      <div class="toc-card" id="post-toc">
        <h3 class="toc-title"><i data-lucide="list"></i> Table of Contents</h3>
        <nav class="toc-list" id="post-toc-list">
          <!-- Populated by JS -->
        </nav>
      </div>

      <div class="share-card">
        <h3 class="share-card-title">Share this article</h3>
        <div class="share-icons">
          <a href="#" class="share-icon" id="share-twitter" aria-label="Share on Twitter">
            <i data-lucide="twitter"></i>
          </a>
          <a href="#" class="share-icon" id="share-linkedin" aria-label="Share on LinkedIn">
            <i data-lucide="linkedin"></i>
          </a>
          <a href="#" class="share-icon" id="share-copy" aria-label="Copy link">
            <i data-lucide="link"></i>
          </a>
          <a href="#" class="share-icon" id="share-email" aria-label="Share via email">
            <i data-lucide="mail"></i>
          </a>
        </div>
      </div>

      <div id="substack-card" style="display: none;">
        <a href="#" id="substack-link" target="_blank" rel="noopener" class="btn btn-outline" style="width: 100%; justify-content: center; gap: var(--space-2);">
          <i data-lucide="external-link"></i> View on Substack
        </a>
      </div>

    </aside>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-brand">
          <div class="footer-logo">sushi<span class="logo-dot">.</span>lab</div>
          <p class="footer-tagline">A living archive of explorations, experiments, and everything in between. Passionate about AI, ML, and pushing boundaries.</p>
          <div class="footer-social">
            <a href="https://github.com/shushankai" target="_blank" rel="noopener" aria-label="GitHub"><i data-lucide="github"></i></a>
            <a href="https://x.com/thisisshushank" target="_blank" rel="noopener" aria-label="Twitter"><i data-lucide="twitter"></i></a>
            <a href="https://www.linkedin.com/in/shushank-singh-251943201" target="_blank" rel="noopener" aria-label="LinkedIn"><i data-lucide="linkedin"></i></a>
            <a href="mailto:shushank.brain@gmail.com" aria-label="Mail"><i data-lucide="mail"></i></a>
          </div>
        </div>
        <div class="footer-column">
          <h4>Explore</h4>
          <ul>
            <li><a href="/blog/">Blog</a></li>
            <li><a href="/tutorials/">Tutorials</a></li>
            <li><a href="/projects/">Projects</a></li>
            <li><a href="/about/">About</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h4>Connect</h4>
          <ul>
            <li><a href="https://github.com/shushankai" target="_blank" rel="noopener">GitHub</a></li>
            <li><a href="https://x.com/thisisshushank" target="_blank" rel="noopener">Twitter</a></li>
            <li><a href="https://www.linkedin.com/in/shushank-singh-251943201" target="_blank" rel="noopener">LinkedIn</a></li>
            <li><a href="mailto:shushank.brain@gmail.com">Email</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h4>More</h4>
          <ul>
            <li><a href="#">RSS Feed</a></li>
            <li><a href="#">Newsletter</a></li>
            <li><a href="#">Uses</a></li>
            <li><a href="#">Colophon</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-divider"></div>
      <div class="footer-bottom">
        <p class="footer-copyright">&copy; 2026 sushi.lab. All rights reserved.</p>
        <div class="footer-bottom-links">
          <a href="#">Privacy</a>
          <a href="#">Terms</a>
        </div>
      </div>
      <div class="footer-brand-watermark" aria-hidden="true">sushi.lab</div>
    </div>
  </footer>

  <script type="module" src="/src/js/main.js"></script>
  <script type="module">
    const TAG_CLASSES = ['tag-accent', 'tag-purple', 'tag-green', 'tag-yellow', 'tag-default'];

    /** Escape HTML entities to prevent XSS in dynamic content */
    function esc(str) {
      const el = document.createElement('span');
      el.textContent = str;
      return el.innerHTML;
    }

    async function loadPost() {
      const params = new URLSearchParams(window.location.search);
      const slug = params.get('slug');

      // Validate slug format
      if (!slug || !/^[a-zA-Z0-9_-]+$/.test(slug)) {
        window.location.href = '/blog/';
        return;
      }

      try {
        const res = await fetch(`/blog/_rendered/${slug}.json`);
        if (!res.ok) throw new Error('Post not found');
        const data = await res.json();
        const { meta, content } = data;

        // Update page title
        document.title = `${meta.title} - sushi.lab`;

        // Update dynamic meta tags for SEO
        const descMeta = document.querySelector('meta[name="description"]');
        if (descMeta) descMeta.content = meta.description || meta.title;
        const ogTitle = document.querySelector('meta[property="og:title"]');
        if (!ogTitle) { const m = document.createElement('meta'); m.setAttribute('property', 'og:title'); m.content = meta.title; document.head.appendChild(m); }
        else ogTitle.content = meta.title;
        const ogDesc = document.querySelector('meta[property="og:description"]');
        if (!ogDesc) { const m = document.createElement('meta'); m.setAttribute('property', 'og:description'); m.content = meta.description || ''; document.head.appendChild(m); }
        else ogDesc.content = meta.description || '';

        // Populate hero
        document.getElementById('post-title').textContent = meta.title;
        const subtitleTmp = document.createElement('span');
        subtitleTmp.innerHTML = meta.description || '';
        document.getElementById('post-subtitle').textContent = subtitleTmp.textContent;

        if (meta.creator) {
          document.getElementById('post-author').textContent = meta.creator;
        }

        // Tags (escaped)
        const tagsEl = document.getElementById('post-tags');
        tagsEl.innerHTML = (meta.tags || []).map((tag, i) =>
          `<span class="tag ${TAG_CLASSES[i % TAG_CLASSES.length]}">${esc(tag)}</span>`
        ).join('');

        // Author meta
        const dateStr = meta.date ? new Date(meta.date + 'T00:00:00').toLocaleDateString('en-US', {
          month: 'long', day: 'numeric', year: 'numeric'
        }) : '';
        document.getElementById('post-meta').innerHTML = [
          dateStr ? `<span><i data-lucide="calendar"></i> ${esc(dateStr)}</span>` : '',
          meta.readTime ? `<span><i data-lucide="clock"></i> ${esc(meta.readTime)}</span>` : ''
        ].filter(Boolean).join('');

        // Inject HTML content from Substack (already sanitized by build-blog.js)
        const body = document.getElementById('post-body');
        body.innerHTML = content || '<p style="color: var(--color-text-muted);">No content available.</p>';

        // Style Substack HTML content to match site design + lazy load images
        body.querySelectorAll('img').forEach(img => {
          img.style.maxWidth = '100%';
          img.style.borderRadius = 'var(--radius-md)';
          img.style.marginBottom = 'var(--space-6)';
          img.loading = 'lazy';
          img.decoding = 'async';
        });

        // Build TOC from h2 headings in the content
        const tocList = document.getElementById('post-toc-list');
        const h2s = body.querySelectorAll('h2');
        if (h2s.length > 0) {
          tocList.innerHTML = Array.from(h2s).map((h2, i) => {
            const id = h2.id || 'section-' + h2.textContent.toLowerCase().replace(/[^\w\s-]/g, '').replace(/\s+/g, '-');
            h2.id = id;
            return `<a href="#${esc(id)}" class="toc-link${i === 0 ? ' active' : ''}">${esc(h2.textContent)}</a>`;
          }).join('');
        } else {
          document.getElementById('post-toc').style.display = 'none';
        }

        // Show "View on Substack" button
        if (meta.link) {
          const substackCard = document.getElementById('substack-card');
          const substackLink = document.getElementById('substack-link');
          substackLink.href = meta.link;
          substackCard.style.display = 'block';
        }

        // Share links
        const url = window.location.href;
        const title = meta.title;
        document.getElementById('share-twitter').href =
          `https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(url)}`;
        document.getElementById('share-linkedin').href =
          `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`;
        document.getElementById('share-email').href =
          `mailto:?subject=${encodeURIComponent(title)}&body=${encodeURIComponent(url)}`;
        document.getElementById('share-copy').addEventListener('click', (e) => {
          e.preventDefault();
          if (navigator.clipboard) {
            navigator.clipboard.writeText(url);
          }
        });

        // Inject BlogPosting JSON-LD structured data
        const ld = document.createElement('script');
        ld.type = 'application/ld+json';
        ld.textContent = JSON.stringify({
          '@context': 'https://schema.org',
          '@type': 'BlogPosting',
          headline: meta.title,
          description: meta.description || '',
          datePublished: meta.date || '',
          author: { '@type': 'Person', name: meta.creator || 'Shushank Singh' },
          publisher: { '@type': 'Person', name: 'Shushank Singh' },
          url: url
        });
        document.head.appendChild(ld);

        // Re-init lucide icons
        if (window.__lucideInit) window.__lucideInit();

      } catch (err) {
        document.getElementById('post-title').textContent = 'Post Not Found';
        document.getElementById('post-subtitle').textContent = '';
        document.getElementById('post-body').innerHTML =
          `<p style="color: var(--color-text-muted);">Could not load this post. <a href="/blog/">Return to blog.</a></p>`;
      }
    }

    loadPost().catch(err => {
      console.error('[sushi.lab] Failed to load post:', err);
      document.getElementById('post-body').innerHTML =
        '<p style="color: var(--color-text-muted);">An error occurred loading this post. Please try refreshing the page.</p>';
    });
  </script>
</body>
</html>
